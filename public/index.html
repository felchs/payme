<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PayPal Guest Payment</title>
  <!-- Use LIVE client ID for guest payments -->
  <script src="https://www.paypal.com/sdk/js?client-id=AcmUlUxLsdw-GhQPQ5n6bT-oXlX-HFFMNNdLY3qUAdDo_a4H3ALkXaOHLKL4VKk99S8gRGLBq2RZH0vL&currency=USD&commit=true&intent=capture"></script>
</head>
<body>
  <h1>Comprar licença</h1>
  <div id="paypal-button-container"></div>

  <script>
    paypal.Buttons({
      style: {
        layout: 'vertical',
        color: 'blue',
        shape: 'rect',
        label: 'paypal'
      },
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: '9.99'
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert("Pagamento confirmado: " + details.payer.email_address);

          // POST para a API licenseme
          fetch('/api/licenseme', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              payerID: data.payerID,
              orderID: data.orderID,
              email: details.payer.email_address
            })
          })
          .then(res => res.json())
          .then(json => {
            alert("Licença gerada: " + json.license);
          });
        });
      }
    }).render('#paypal-button-container');
  </script>
</body>
</html>