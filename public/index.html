<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PayPal Guest Payment</title>
  <link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">

  <!-- LIVE --> 
  <!--
  <script src="https://www.paypal.com/sdk/js?client-id=ASen3waDjnpwBZwaKRe5MN1cgm6THmfaxCWo5JtEDX2eyh2U4BGRekTFDsA14_kAb7RI_3QG-ojnZBFJ&currency=BRL&commit=true&intent=capture&components=buttons&enable-funding=card&disable-funding=applepay,paylater"></script>
  -->
  <!-- SANDBOX --> 
  <script src="https://www.paypal.com/sdk/js?client-id=ARYfdKWgzvTi1z4bWu4JvVCEgMi_KDfqZFGhpLseNbfk-f5J5nsV_Rx3Ac_MM0TNDyIBFFEdpsWxvIZ0&currency=BRL&commit=true&intent=capture&components=buttons&enable-funding=card&disable-funding=applepay,paylater"></script>

  <style>
  body {
      border: none;
      outline: none;
      margin: 0;
      padding: 0;
      background: white;
    }
  </style>
</head>
<body>
  <div>
    <div style="background-color: #F0F0F0; float:left; width:100%; height:64px">
      <div style="width:25%; background-color: transparent; float:left; margin-top: 12px; margin-left:12px; font-size:48px; font-family: 'Josefin Sans', sans-serif;">
        ImagePro
      </div>
      <div style="width:20%; background-color: transparent; float:left; text-align: center; font-size: 24px; margin-top: 18px; font-family: 'Raleway', sans-serif;">
        
      </div>
      <div style="width:54%; background-color: transparent; float:right; text-align: center; font-size: 18px; margin-top: 20px; font-family: 'Raleway', sans-serif;">
          <div style="float:right; width:20px;">&nbsp;</div>
          <div style="float:right; width:120px;">Facebook</div>
          <div style="float:right; width:120px;">Instagram</div>
          <div style="float:right; width:120px;">Tiktok</div>
          <div style="float:right; width:120px;">Kwai</div>
      </div>
      <div style="width:24%; background-color: darkorchid; float:left; text-align: right; font-family: 'Raleway', sans-serif;">
      </div>
    </div>
    <div style="background-color: black; float:left; width:100%; height:auto; font-family: 'Questrial', sans-serif;">
      <div style="background-color: black; color:white; float:left; width:30%; height:100%;">
        <div style="float:left; letter-spacing: -0.03em; font-size: 96px; margin-top: 136px; margin-left:32px">
          See<br>
          What is<br>
          Behind the<br>
          Scenes
        </div>
      </div>
      <div style="background-color: #E0E0E0; float:left; width:70%; height:100%;  padding-bottom: 110px;">
        <div style="width:100%; height:75%; float:left; margin-top:20px; display:flex; justify-content:center; align-items:center;">
          <img src="payme.png" style="width:70%; height:auto;">
        </div>
        <div style="width:100%; float: left; margin: 0 auto; align-items: center;">
          <div style="width:100%; float:left; text-align: center; margin-top: 50px;">To buy the software follow the payment</div>
          <div style="width:100%; float:left; float:left; text-align: center;">
            <div style="width:400px; background-color: transparent; margin:0 auto;" id="a">
              <div style="margin:0 auto;" id="paypal-button-container">&nbsp;</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const uniqueId = urlParams.get('id');
    console.log("ID from URL:", uniqueId);
  
    paypal.Buttons({
      style: {
        layout: 'vertical',
        color: 'blue',
        shape: 'rect',
        label: 'paypal'
      },
      createOrder: function(data, actions) {
	  	console.log("create order...0");
		
        return actions.order.create({
          purchase_units: [{
            amount: {
			        currency_code: "BRL",
              value: '5.89'
            }
          }]
        });
      },
      onApprove: function(data, actions) {
		    console.log("on approve...0");
				console.log("on approve...0 orderId: " + data.orderID);
		
        return actions.order.capture().then(function(details) {
		      
		      console.log("Payer Order Id: " + data.orderID);
		      console.log("Payment email: " + details.payer.email_address);
          console.log("UniqueId: " + uniqueId);

          // POST para a API licenseme
          fetch('/api/licenseme', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              orderID: data.orderID,
              email: details.payer.email_address,
              uniqueID: uniqueId
            })
          })
          .then(res => res.json())
          .then(json => {
            console.log("License result: " + json.license);
          });
		  
        });
      },
	    onError: function(err) {
		    console.error("PayPal error:", err);
	    }
    }).render('#paypal-button-container');
  </script>
</body>
</html>